{% extends "base.html" %}

{% block title %}Booking #{{ booking.id }} - ArielGo Admin{% endblock %}

{% block content %}
<div class="booking-detail">
    <div class="page-header">
        <h2>Booking #{{ booking.id }}</h2>
        <a href="{{ url_for('bookings') }}" class="btn-back">← Back to Bookings</a>
    </div>

    <div class="detail-grid">
        <div class="detail-section">
            <h3>Customer Information</h3>
            <div class="detail-row">
                <span class="label">Name:</span>
                <span class="value">{{ booking.name }}</span>
            </div>
            <div class="detail-row">
                <span class="label">Phone:</span>
                <span class="value">{{ booking.phone }}</span>
            </div>
            <div class="detail-row">
                <span class="label">Email:</span>
                <span class="value">{{ booking.email }}</span>
            </div>
        </div>

        <div class="detail-section">
            <h3>Booking Details</h3>
            <div class="detail-row">
                <span class="label">Service Type:</span>
                <span class="value">{{ booking.service }}</span>
            </div>
            <div class="detail-row">
                <span class="label">Number of Bags:</span>
                <span class="value">{{ booking.numberOfBags }}</span>
            </div>
            <div class="detail-row">
                <span class="label">Total:</span>
                <span class="value">${{ "%.2f"|format(booking.totalPrice / 100) }}</span>
            </div>
            <div class="detail-row">
                <span class="label">Status:</span>
                <span class="value"><span class="status-badge status-{{ booking.status }}">{{ booking.status }}</span></span>
            </div>
        </div>

        <div class="detail-section">
            <h3>Pickup Information</h3>
            <div class="detail-row">
                <span class="label">Address:</span>
                <span class="value">{{ booking.address }}</span>
            </div>
            <div class="detail-row">
                <span class="label">Date:</span>
                <span class="value">{{ booking.pickupDate }}</span>
            </div>
            <div class="detail-row">
                <span class="label">Time:</span>
                <span class="value">{{ booking.pickupTime }}</span>
            </div>
            {% if booking.notes %}
            <div class="detail-row">
                <span class="label">Notes:</span>
                <span class="value">{{ booking.notes }}</span>
            </div>
            {% endif %}
        </div>

        <div class="detail-section">
            <h3>Timestamps</h3>
            <div class="detail-row">
                <span class="label">Created:</span>
                <span class="value">{{ booking.createdAt }}</span>
            </div>
            <div class="detail-row">
                <span class="label">Last Updated:</span>
                <span class="value">{{ booking.updatedAt }}</span>
            </div>
        </div>
    </div>

    <div class="status-update-section">
        <h3>Update Status</h3>
        <form method="POST" action="{{ url_for('update_status', booking_id=booking.id) }}">
            <select name="status" class="status-select">
                <option value="pending" {% if booking.status == 'pending' %}selected{% endif %}>Pending</option>
                <option value="confirmed" {% if booking.status == 'confirmed' %}selected{% endif %}>Confirmed</option>
                <option value="in_progress" {% if booking.status == 'in_progress' %}selected{% endif %}>In Progress</option>
                <option value="completed" {% if booking.status == 'completed' %}selected{% endif %}>Completed</option>
                <option value="cancelled" {% if booking.status == 'cancelled' %}selected{% endif %}>Cancelled</option>
            </select>
            <button type="submit" class="btn-primary">Update Status</button>
        </form>
    </div>

    <div class="status-update-section">
        <h3>Assign Driver</h3>
        {% if booking.driver_name %}
        <p style="color: var(--color-green-light); margin-bottom: 1rem;">
            ✓ Currently assigned to: <strong>{{ booking.driver_name }}</strong>
        </p>
        {% endif %}
        <form method="POST" action="{{ url_for('assign_driver', booking_id=booking.id) }}">
            <select name="driver_id" class="status-select" required>
                <option value="">Select a driver...</option>
                {% for driver in drivers %}
                <option value="{{ driver.id }}" {% if booking.driver_id == driver.id %}selected{% endif %}>
                    {{ driver.full_name }} ({{ driver.username }})
                </option>
                {% endfor %}
            </select>
            <button type="submit" class="btn-primary">Assign Driver</button>
        </form>
    </div>
</div>
{% endblock %}
