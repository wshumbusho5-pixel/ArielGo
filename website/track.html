<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Track Your Order - ArielGo Laundry</title>
    <link rel="stylesheet" href="/css/style.css">
    <style>
        .track-container {
            max-width: 600px;
            margin: 80px auto 40px;
            padding: 0 20px;
        }

        .track-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 40px;
        }

        .track-card h1 {
            color: #2563eb;
            margin-bottom: 10px;
            font-size: 28px;
        }

        .track-card .subtitle {
            color: #64748b;
            margin-bottom: 30px;
        }

        .search-section {
            margin-bottom: 30px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #475569;
            font-weight: 500;
        }

        .input-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
        }

        .input-group input:focus {
            outline: none;
            border-color: #2563eb;
        }

        .track-button {
            width: 100%;
            padding: 14px;
            background: #2563eb;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .track-button:hover {
            background: #1d4ed8;
        }

        .track-button:disabled {
            background: #cbd5e1;
            cursor: not-allowed;
        }

        .order-details {
            display: none;
            margin-top: 30px;
            padding-top: 30px;
            border-top: 1px solid #e2e8f0;
        }

        .order-details.visible {
            display: block;
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 25px;
        }

        .order-id {
            font-size: 18px;
            font-weight: 600;
            color: #1e293b;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            text-transform: capitalize;
        }

        .status-pending { background: #fef3c7; color: #92400e; }
        .status-confirmed { background: #dbeafe; color: #1e40af; }
        .status-in_progress { background: #e0e7ff; color: #4338ca; }
        .status-completed { background: #d1fae5; color: #065f46; }
        .status-cancelled { background: #fee2e2; color: #991b1b; }

        .progress-tracker {
            margin: 30px 0;
        }

        .progress-step {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            position: relative;
        }

        .progress-step:not(:last-child)::after {
            content: '';
            position: absolute;
            left: 20px;
            top: 50px;
            width: 2px;
            height: 40px;
            background: #e2e8f0;
        }

        .progress-step.completed::after {
            background: #10b981;
        }

        .step-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e2e8f0;
            color: #64748b;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .progress-step.completed .step-icon {
            background: #10b981;
            color: white;
        }

        .progress-step.current .step-icon {
            background: #2563eb;
            color: white;
        }

        .step-content {
            flex: 1;
        }

        .step-title {
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 4px;
        }

        .step-time {
            font-size: 14px;
            color: #64748b;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #f1f5f9;
        }

        .detail-row:last-child {
            border-bottom: none;
        }

        .detail-label {
            color: #64748b;
        }

        .detail-value {
            font-weight: 600;
            color: #1e293b;
            text-align: right;
        }

        .error-message {
            background: #fee2e2;
            color: #991b1b;
            padding: 12px 16px;
            border-radius: 8px;
            margin-top: 15px;
            display: none;
        }

        .error-message.visible {
            display: block;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #64748b;
        }
    </style>
</head>
<body>
    <div class="track-container">
        <div class="track-card">
            <h1>Track Your Order</h1>
            <p class="subtitle">Enter your booking ID and email to track your laundry delivery</p>

            <div class="search-section">
                <form id="trackForm">
                    <div class="input-group">
                        <label for="bookingId">Booking ID</label>
                        <input
                            type="text"
                            id="bookingId"
                            name="bookingId"
                            placeholder="e.g., 12345"
                            required
                        >
                    </div>

                    <div class="input-group">
                        <label for="email">Email Address</label>
                        <input
                            type="email"
                            id="email"
                            name="email"
                            placeholder="your@email.com"
                            required
                        >
                    </div>

                    <button type="submit" class="track-button" id="trackButton">
                        Track Order
                    </button>
                </form>

                <div class="error-message" id="errorMessage"></div>
            </div>

            <div class="order-details" id="orderDetails">
                <div class="order-header">
                    <div class="order-id" id="orderId">Order #12345</div>
                    <span class="status-badge" id="statusBadge">Pending</span>
                </div>

                <div class="progress-tracker" id="progressTracker">
                    <!-- Progress steps will be inserted here -->
                </div>

                <div class="detail-section">
                    <div class="detail-row">
                        <span class="detail-label">Customer Name</span>
                        <span class="detail-value" id="customerName">-</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Service Type</span>
                        <span class="detail-value" id="serviceType">-</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Number of Bags</span>
                        <span class="detail-value" id="numberOfBags">-</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Date</span>
                        <span class="detail-value" id="pickupDate">-</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Pickup Time</span>
                        <span class="detail-value" id="pickupTime">-</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Address</span>
                        <span class="detail-value" id="address">-</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Total Price</span>
                        <span class="detail-value" id="totalPrice">-</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = window.location.origin;

        document.getElementById('trackForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const bookingId = document.getElementById('bookingId').value;
            const email = document.getElementById('email').value;
            const button = document.getElementById('trackButton');
            const errorMessage = document.getElementById('errorMessage');
            const orderDetails = document.getElementById('orderDetails');

            // Reset
            errorMessage.classList.remove('visible');
            orderDetails.classList.remove('visible');
            button.disabled = true;
            button.textContent = 'Tracking...';

            try {
                const response = await fetch(`${API_BASE}/api/bookings/${bookingId}`);

                if (!response.ok) {
                    throw new Error('Booking not found');
                }

                const data = await response.json();
                const booking = data.booking;

                // Verify email matches
                if (booking.email.toLowerCase() !== email.toLowerCase()) {
                    throw new Error('Email does not match our records');
                }

                // Display order details
                displayOrderDetails(booking);

            } catch (error) {
                errorMessage.textContent = error.message || 'Failed to track order. Please check your details and try again.';
                errorMessage.classList.add('visible');
            } finally {
                button.disabled = false;
                button.textContent = 'Track Order';
            }
        });

        function displayOrderDetails(booking) {
            document.getElementById('orderId').textContent = `Order #${booking.id}`;
            document.getElementById('statusBadge').textContent = booking.status.replace('_', ' ');
            document.getElementById('statusBadge').className = `status-badge status-${booking.status}`;

            document.getElementById('customerName').textContent = booking.name;
            document.getElementById('serviceType').textContent = formatService(booking.service);
            document.getElementById('numberOfBags').textContent = booking.numberOfBags;
            document.getElementById('pickupDate').textContent = formatDate(booking.pickupDate);
            document.getElementById('pickupTime').textContent = booking.pickupTime || 'TBD';
            document.getElementById('address').textContent = booking.address;
            document.getElementById('totalPrice').textContent = `$${(booking.totalPrice / 100).toFixed(2)}`;

            // Build progress tracker
            buildProgressTracker(booking.status);

            document.getElementById('orderDetails').classList.add('visible');
        }

        function buildProgressTracker(currentStatus) {
            const steps = [
                { id: 'pending', title: 'Order Received', icon: '1' },
                { id: 'confirmed', title: 'Order Confirmed', icon: '2' },
                { id: 'in_progress', title: 'Pickup & Processing', icon: '3' },
                { id: 'completed', title: 'Delivered', icon: '4' }
            ];

            const statusOrder = ['pending', 'confirmed', 'in_progress', 'completed'];
            const currentIndex = statusOrder.indexOf(currentStatus);

            const html = steps.map((step, index) => {
                let className = 'progress-step';
                if (index < currentIndex) {
                    className += ' completed';
                } else if (index === currentIndex) {
                    className += ' current';
                }

                return `
                    <div class="${className}">
                        <div class="step-icon">${step.icon}</div>
                        <div class="step-content">
                            <div class="step-title">${step.title}</div>
                            ${index === currentIndex ? '<div class="step-time">Current Status</div>' : ''}
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('progressTracker').innerHTML = html;
        }

        function formatService(service) {
            const serviceMap = {
                'standard': 'Standard (24-hour)',
                'same-day': 'Same-Day Service',
                'rush': 'Rush (4-hour)'
            };
            return serviceMap[service] || service;
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }

        // Auto-fill from URL parameters if present
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('id')) {
            document.getElementById('bookingId').value = urlParams.get('id');
        }
        if (urlParams.get('email')) {
            document.getElementById('email').value = urlParams.get('email');
        }
    </script>
</body>
</html>
